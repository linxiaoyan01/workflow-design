## 4. 审批流应用

### 4.1 审批流介绍

审批流是工作流的一种，广泛的应用于各个企业中，无论大公司还是小公司，或多或少的都存在审批相关的流程、工作、岗位，因此，具有普适性。
同样，我们也注意到，鉴于各家企业实际情况的不同，它们的审批流应用也各不相同，但是，它们的底层-审批流引擎-基本没有什么特别大的差异。
本章以开发一个简易的审批流引擎为例，说明如何使用工作流引擎。


为了更好的说明如何进行设计，需要把审批流相关的概念先说清楚，否则，这个设计就如空中楼阁，失去了标的。

审批流程规定了一个申请单的流转，有哪些节点，节点上有哪些人审批等，它就是一个流程定义。经过审批人的审批，同意后，流程接着流转到下一个节点，以此类推，直到审批结束。

审批节点有审批类型的概念，一般为并签、或签，并签是指该节点上的所有审批人都审批同意后，该节点才算是审批通过，有任何一个人审批不通过，就意味着该节点不通过，类似于一票否决。
或签是指该节点上的所有审批人中的第一个审批人审批同意，该节点就算通过，审批不通过时，就是不通过。

还有一类是串签，即：A审批完给B、B审批完给C，这一类只是单人或签+流程定义的一个变种而已，无需特殊处理。

审批时，有时需要别人加签，即：A审批时，发现这个申请单需要X先审批，而X没有审批过此单，故A需要加签给X，X通过后，A在审批。

除了审批之外，流程中还需要有一些抄送通知类的需求，即：M审批节点审批通过后，需要告知A、B这件事情，这个时候，就需要抄送节点了。

除此之外，还需要分支节点，即：根据一些条件，来决定流程接下来的走向，哪些走，哪些不走。


到此，以上说明足以覆盖大部分审批流类应用场景了，复杂的审批流应用还有主子流程、流程预测、流程仿真、驳回到任意节点、取回、撤销、传阅以及各种加减签与或并签的任意嵌套等功能，由于篇幅关系，这里就不涉及了。

接下来，以一个实际的报销流程，来说明如何应用上述概念、功能，如下图所示：

![图](http://assets.processon.com/chart_image/61d652897d9c0836570eb72f.png)


首先，申请人发起了一个报销申请流程，他先填写申请单，如果申请单中的金额小于100元，那么这个单子就会先由财务审批，具体来讲，是张三、李四并签，只有他们俩都审批通过后，才会走接下来出纳审批，由王五、赵六或签，他们俩之一审批通过后，走接下来的抄送HR节点，把这个事情告知刘二、三毛两人，然后流程结束。当然，这只是金额小于100元的情况，当金额大于100元时，除了上述流转，还需要董事长审批，董事长也通过后，这个流程才算是结束。这里有个小插曲，董事长审批时，由于他不了解情况，加签给了经理，等经理审批后，董事长才审批。




### 4.2 审批流引擎开发

首先是流程定义，更多的是看看有哪些流程节点类型，从上节的描述中，可以看出应该有以下几种类型：

* 审批节点，提供并签、或签能力，能够生成某个人、某些人的审批任务
* 抄送节点，生成某个人、某些人的阅读任务
* 填写申请单节点，生成某个人的填写表单任务
* 分支节点，根据不同的条件，走不同的分支流程
* 分支汇聚节点，使得分支流程能够汇聚到主流程上


### 4.3 审批流引擎示例